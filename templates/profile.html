{% extends "base_platform.html" %}

{% block content %}
<div class="relative min-h-full p-8 font-sans overflow-hidden">
    <!-- Background Decor -->
    <div
        class="absolute top-0 right-0 w-[500px] h-[500px] bg-blue-600/10 rounded-full blur-[100px] -mr-32 -mt-32 pointer-events-none">
    </div>
    <div
        class="absolute bottom-0 left-0 w-[500px] h-[500px] bg-purple-600/10 rounded-full blur-[100px] -ml-32 -mb-32 pointer-events-none">
    </div>

    <div class="relative max-w-6xl mx-auto space-y-8">
        <!-- HEADER / IDENTITY CARD -->
        <div class="glass-panel p-8 rounded-3xl border border-white/5 relative overflow-hidden group">
            <div
                class="absolute inset-0 bg-gradient-to-r from-blue-600/10 to-purple-600/10 opacity-50 group-hover:opacity-100 transition duration-700">
            </div>

            <div class="relative flex flex-col md:flex-row items-center md:items-start gap-8">
                <!-- Avatar -->
                <div class="relative">
                    <div
                        class="w-32 h-32 rounded-full bg-gradient-to-br from-slate-800 to-slate-900 flex items-center justify-center text-4xl font-bold text-white shadow-2xl border-4 border-slate-800/50 ring-2 ring-white/10">
                        {{ user.username[0]|upper }}
                    </div>
                    <div class="absolute bottom-2 right-2 w-6 h-6 bg-green-500 rounded-full border-4 border-slate-900"
                        title="Online"></div>
                </div>

                <!-- Info -->
                <div class="flex-1 text-center md:text-left space-y-2">
                    <h1 class="text-4xl font-bold text-white tracking-tight">{{ user.username }}</h1>
                    <p class="text-slate-400 text-lg flex items-center justify-center md:justify-start gap-2">
                        <i data-lucide="mail" class="w-4 h-4"></i> {{ user.email }}
                    </p>
                    <div class="flex items-center justify-center md:justify-start gap-3 mt-4">
                        <span
                            class="px-3 py-1 rounded-full bg-blue-500/20 text-blue-300 border border-blue-500/30 text-xs font-bold uppercase tracking-wider">
                            Pro Plan
                        </span>
                        <span
                            class="px-3 py-1 rounded-full bg-slate-800 text-slate-400 border border-white/5 text-xs font-bold uppercase tracking-wider">
                            Member since {{ user.created_at.strftime('%Y') }}
                        </span>
                    </div>
                </div>

                <!-- Action -->
                <div class="flex flex-col gap-3 min-w-[160px]">
                    <button onclick="editProfile()"
                        class="px-6 py-3 bg-white text-slate-900 rounded-xl font-bold hover:bg-slate-200 transition flex items-center justify-center gap-2 shadow-lg shadow-white/5">
                        <i data-lucide="edit-3" class="w-4 h-4"></i> Edit Profile
                    </button>
                </div>
            </div>
        </div>

        <!-- STATS GRID -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="glass-panel p-6 rounded-2xl border border-white/5 relative overflow-hidden">
                <div class="flex justify-between items-start mb-4">
                    <div class="p-3 bg-blue-500/20 rounded-xl">
                        <i data-lucide="layers" class="w-6 h-6 text-blue-400"></i>
                    </div>
                </div>
                <!-- Removed +12% badge -->
                <h3 class="text-3xl font-bold text-white mb-1">{{ stats.total_sessions }}</h3>
                <p class="text-sm text-slate-500">Total Audits Ran</p>
            </div>

            <div class="glass-panel p-6 rounded-2xl border border-white/5 relative overflow-hidden">
                <div class="flex justify-between items-start mb-4">
                    <div class="p-3 bg-purple-500/20 rounded-xl">
                        <i data-lucide="check-circle-2" class="w-6 h-6 text-purple-400"></i>
                    </div>
                    <span class="text-xs font-bold text-purple-400 bg-purple-400/10 px-2 py-1 rounded">Avg</span>
                </div>
                <h3 class="text-3xl font-bold text-white mb-1">{{ stats.success_rate }}%</h3>
                <p class="text-sm text-slate-500">Success Rate</p>
            </div>
            <!-- Removed Credits Remaining Card -->
        </div>

        <!-- ACCOUNT & SETTINGS -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <!-- Details Form -->
            <div class="md:col-span-2 glass-panel p-8 rounded-3xl border border-white/5">
                <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                    <i data-lucide="user-cog" class="w-5 h-5 text-slate-400"></i> Account Details
                </h3>
                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-slate-500 uppercase">Username</label>
                            <input type="text" value="{{ user.username }}" readonly
                                class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 text-slate-300 focus:outline-none">
                        </div>
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-slate-500 uppercase">Email Address</label>
                            <input type="email" value="{{ user.email }}" readonly
                                class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 text-slate-300 focus:outline-none">
                        </div>
                    </div>

                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-500 uppercase">User ID</label>
                        <div class="relative group">
                            <input type="text" value="{{ user.id }}" readonly
                                class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 text-slate-400 font-mono text-sm focus:outline-none">
                            <button
                                onclick="navigator.clipboard.writeText('{{ user.id }}'); Swal.fire({icon:'success', title:'Copied!', toast:true, position:'top-end', showConfirmButton:false, timer:1500})"
                                class="absolute right-2 top-2 p-1.5 hover:bg-slate-700 rounded-lg text-slate-500 transition">
                                <i data-lucide="copy" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>

                    <div class="pt-6 border-t border-slate-800">
                        <h4 class="text-sm font-bold text-white mb-4">Security</h4>
                        <button onclick="changePassword()"
                            class="px-4 py-2 border border-slate-600 hover:bg-slate-800 text-slate-300 rounded-lg text-sm font-medium transition flex items-center gap-2">
                            <i data-lucide="lock" class="w-4 h-4"></i> Change Password
                        </button>
                    </div>
                </div>
            </div>

            <!-- Session Control (Moved here, Preferences Removed) -->
            <div class="md:col-span-1 space-y-6">
                <div class="glass-panel p-8 rounded-3xl border border-red-500/20 bg-red-500/5">
                    <h3 class="text-base font-bold text-red-400 mb-4 text-center">Session Control</h3>
                    <p class="text-xs text-red-400/50 text-center mb-6">Securely end your current session.</p>
                    <button onclick="logout()"
                        class="w-full py-3 bg-red-500 hover:bg-red-400 text-white rounded-xl font-bold shadow-lg shadow-red-500/20 transition flex items-center justify-center gap-2">
                        <i data-lucide="log-out" class="w-4 h-4"></i> Sign Out
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    function logout() {
        Swal.fire({
            title: 'Signing out...',
            text: 'See you next time!',
            background: '#0f172a',
            color: '#fff',
            showConfirmButton: false,
            timer: 1000
        }).then(() => {
            document.cookie = "access_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
            window.location.href = "/login";
        });
    }

    function editProfile() {
        Swal.fire({
            icon: 'info',
            title: 'Profile Settings',
            text: 'Profile editing is reserved for admin users in this demo environment.',
            background: '#0f172a',
            color: '#fff',
            confirmButtonColor: '#3b82f6'
        });
    }

    function changePassword() {
        Swal.fire({
            icon: 'info',
            title: 'Change Password',
            text: 'To change your password, please use the reset password flow.',
            background: '#0f172a',
            color: '#fff',
            confirmButtonText: 'Go to Reset',
            confirmButtonColor: '#3b82f6',
            showCancelButton: true,
            cancelButtonColor: '#64748b'
        }).then((result) => {
            if (result.isConfirmed) {
                // Since we don't have a direct "change password" page authenticated, 
                // we'll send them to the public reset flow or just show a message for now.
                // Assuming /reset-password exists or similar.
                window.location.href = '/reset-password';
                // If /reset-password is not the right route, user can navigate back.
                // Alternatively, we could ask for current + new password here if an API existed.
            }
        });
    }
</script>
{% endblock %}